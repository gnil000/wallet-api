# Тестовое задание Wallet-API 

* [Задание pdf](/docs/Тестовое%20задание%20golang%20june+.pdf)
* [Описание](#описание)
* [Запуск](#запуск)
* [Http-запросы](#запросы)
* [Тесты](#тесты)

## Описание

Задача реализована на стеке: go, net/http, postgresql, docker.  

Предпринятые решения:  
1. Баланс не может уходить в минус
2. Приходящая в запросе на изменение баланса сумма должна быть > 0
3. Деньги исчисляются в копейках
4. Serializable-транзакции с повторными попытками
5. Проверка, что при изменении баланса он не уйдёт в минус производится в sql запросе
6. DEPOSIT - пополнение баланса, WITHDRAW - снятие с баланса
7. Архитектура: Repository -> Service -> Handler

Версия api `api/v1` - захардкожена

## Запуск

Запуск локально из папки cmd командой:  
```
go run main.go
```

---

**Запуск через Docker-Compose**:
Docker-compose содержит PostgreSQL образ и Wallet-API, постегрес создаёт БД Bank, Wallet-API через миграции подтягивает таблицы и создаёт пять записей кошельков.  
Поскольку uuid's создаются автоматически в БД при вставке значений они будут рандомные, предусмотрен метод GetWallets по адресу `/wallets` получает id всех кошельков.

Все зависимости уже скопированы в Dockerfile.

1. Зайти в папку `deploy`
2. Открыть консоль 
3. Прописать `docker-compose up -d`

## Запросы

**Получить список id всех кошельков**: GET http://localhost:8080/api/v1/wallets  

---

**Получить баланс кошелька по uuid**:   
GET http://localhost:8080/api/v1/wallets/{uuid}  
400 - если id кошелька невозможно распарсить  
404 - не найден кошелёк с таким id  
200 - кошелёк найден  
500 - внутренняя ошибка сервера  

Пример тела ответа:
```
{
    "balance": 9000,
}
```  
или  
```
{
    "code": 404,
    "message": "wallet not found"
}
```

---

**Обновить баланс**:  
POST http://localhost:8080/api/v1/wallet  
200 - операция изменения баланса успешна  
422 - тело запроса не подходит под ожидаемую модель  
404 - кошелёк для изменения баланса не найден  
400 - некорректный тип операции, отрицательная сумма или не хватает средств для проведения операции  
500 - внутренняя ошибка сервера  

В теле ответа приходят описания ошибок, например: `not enough balance` или `wallet not found`

Пример тела запроса:
```
{
    "valletId": "{wallet_id}",
    "operationType": "DEPOSIT",
    "amount": 1000
}
```

или

```
{
    "valletId": "{wallet_id}",
    "operationType": "WITHDRAW",
    "amount": 1500
}
```

Пример тела ответа:  
```
{
    "code": 404,
    "message": "wallet not found"
}
```

## Тесты

Написаны Unit-тесты для `wallet_service` и `wallet_handler`. 
Для `wallet_service` тесты работают, для `wallet_handler` нет)). Я не стала расписывать тесты как на рабочем проекте, сделала, чтобы было понимание что я вообще знаю что это и умею писать.